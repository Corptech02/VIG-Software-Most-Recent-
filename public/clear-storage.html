<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clear Storage Utility</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f0f0f0;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        .btn-success {
            background: #10b981;
            color: white;
        }
        button:hover {
            opacity: 0.9;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }
        .storage-info {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§¹ Storage Cleanup Utility</h1>

        <div class="storage-info">
            <h3>Current Storage Usage:</h3>
            <div id="storageStats"></div>
        </div>

        <h3>Quick Actions:</h3>
        <button class="btn-warning" onclick="clearLeads()">Clear Leads Only</button>
        <button class="btn-warning" onclick="clearPolicies()">Clear Policies Only</button>
        <button class="btn-warning" onclick="clearClients()">Clear Clients Only</button>
        <button class="btn-danger" onclick="clearAll()">Clear ALL localStorage</button>
        <button class="btn-success" onclick="checkStorage()">Refresh Stats</button>

        <div id="status" class="status"></div>

        <h3>Storage Items:</h3>
        <pre id="items"></pre>
    </div>

    <script>
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function getStorageSize() {
            let total = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    total += localStorage[key].length + key.length;
                }
            }
            return total * 2; // Approximate bytes (UTF-16)
        }

        function checkStorage() {
            const stats = document.getElementById('storageStats');
            const items = document.getElementById('items');

            const totalSize = getStorageSize();
            const itemCount = localStorage.length;

            let itemDetails = [];
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    const size = (localStorage[key].length + key.length) * 2;
                    let count = 0;
                    try {
                        const data = JSON.parse(localStorage[key]);
                        if (Array.isArray(data)) count = data.length;
                    } catch(e) {}

                    itemDetails.push({
                        key: key,
                        size: size,
                        count: count
                    });
                }
            }

            itemDetails.sort((a, b) => b.size - a.size);

            stats.innerHTML = `
                <p><strong>Total Size:</strong> ${formatBytes(totalSize)} / ~10 MB (localStorage limit)</p>
                <p><strong>Total Items:</strong> ${itemCount}</p>
                <p><strong>Usage:</strong> ${Math.round((totalSize / (10 * 1024 * 1024)) * 100)}%</p>
            `;

            items.innerHTML = itemDetails.map(item =>
                `${item.key}: ${formatBytes(item.size)}${item.count ? ` (${item.count} items)` : ''}`
            ).join('\n');
        }

        function clearLeads() {
            const keys = ['leads', 'insurance_leads', 'generatedLeads', 'vicidial_leads', 'archived_leads'];
            keys.forEach(key => localStorage.removeItem(key));
            showStatus('Leads cleared successfully!', 'success');
            checkStorage();
        }

        function clearPolicies() {
            const keys = ['insurance_policies', 'policies', 'policy_data'];
            keys.forEach(key => localStorage.removeItem(key));
            showStatus('Policies cleared successfully!', 'success');
            checkStorage();
        }

        function clearClients() {
            const keys = ['clients', 'insurance_clients', 'client_data'];
            keys.forEach(key => localStorage.removeItem(key));
            showStatus('Clients cleared successfully!', 'success');
            checkStorage();
        }

        function clearAll() {
            if (confirm('Are you sure? This will clear ALL localStorage data!')) {
                localStorage.clear();
                showStatus('All localStorage cleared!', 'success');
                checkStorage();
            }
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.className = 'status ' + type;
            status.textContent = message;
            status.style.display = 'block';

            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        // Check storage on load
        checkStorage();
    </script>
</body>
</html>